
% Default to the notebook output style

    


% Inherit from the specified cell style.




    
\documentclass[11pt]{article}

    
    
    \usepackage[T1]{fontenc}
    % Nicer default font (+ math font) than Computer Modern for most use cases
    \usepackage{mathpazo}

    % Basic figure setup, for now with no caption control since it's done
    % automatically by Pandoc (which extracts ![](path) syntax from Markdown).
    \usepackage{graphicx}
    % We will generate all images so they have a width \maxwidth. This means
    % that they will get their normal width if they fit onto the page, but
    % are scaled down if they would overflow the margins.
    \makeatletter
    \def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth
    \else\Gin@nat@width\fi}
    \makeatother
    \let\Oldincludegraphics\includegraphics
    % Set max figure width to be 80% of text width, for now hardcoded.
    \renewcommand{\includegraphics}[1]{\Oldincludegraphics[width=.8\maxwidth]{#1}}
    % Ensure that by default, figures have no caption (until we provide a
    % proper Figure object with a Caption API and a way to capture that
    % in the conversion process - todo).
    \usepackage{caption}
    \DeclareCaptionLabelFormat{nolabel}{}
    \captionsetup{labelformat=nolabel}

    \usepackage{adjustbox} % Used to constrain images to a maximum size 
    \usepackage{xcolor} % Allow colors to be defined
    \usepackage{enumerate} % Needed for markdown enumerations to work
    \usepackage{geometry} % Used to adjust the document margins
    \usepackage{amsmath} % Equations
    \usepackage{amssymb} % Equations
    \usepackage{textcomp} % defines textquotesingle
    % Hack from http://tex.stackexchange.com/a/47451/13684:
    \AtBeginDocument{%
        \def\PYZsq{\textquotesingle}% Upright quotes in Pygmentized code
    }
    \usepackage{upquote} % Upright quotes for verbatim code
    \usepackage{eurosym} % defines \euro
    \usepackage[mathletters]{ucs} % Extended unicode (utf-8) support
    \usepackage[utf8x]{inputenc} % Allow utf-8 characters in the tex document
    \usepackage{fancyvrb} % verbatim replacement that allows latex
    \usepackage{grffile} % extends the file name processing of package graphics 
                         % to support a larger range 
    % The hyperref package gives us a pdf with properly built
    % internal navigation ('pdf bookmarks' for the table of contents,
    % internal cross-reference links, web links for URLs, etc.)
    \usepackage{hyperref}
    \usepackage{longtable} % longtable support required by pandoc >1.10
    \usepackage{booktabs}  % table support for pandoc > 1.12.2
    \usepackage[inline]{enumitem} % IRkernel/repr support (it uses the enumerate* environment)
    \usepackage[normalem]{ulem} % ulem is needed to support strikethroughs (\sout)
                                % normalem makes italics be italics, not underlines
    

    
    
    % Colors for the hyperref package
    \definecolor{urlcolor}{rgb}{0,.145,.698}
    \definecolor{linkcolor}{rgb}{.71,0.21,0.01}
    \definecolor{citecolor}{rgb}{.12,.54,.11}

    % ANSI colors
    \definecolor{ansi-black}{HTML}{3E424D}
    \definecolor{ansi-black-intense}{HTML}{282C36}
    \definecolor{ansi-red}{HTML}{E75C58}
    \definecolor{ansi-red-intense}{HTML}{B22B31}
    \definecolor{ansi-green}{HTML}{00A250}
    \definecolor{ansi-green-intense}{HTML}{007427}
    \definecolor{ansi-yellow}{HTML}{DDB62B}
    \definecolor{ansi-yellow-intense}{HTML}{B27D12}
    \definecolor{ansi-blue}{HTML}{208FFB}
    \definecolor{ansi-blue-intense}{HTML}{0065CA}
    \definecolor{ansi-magenta}{HTML}{D160C4}
    \definecolor{ansi-magenta-intense}{HTML}{A03196}
    \definecolor{ansi-cyan}{HTML}{60C6C8}
    \definecolor{ansi-cyan-intense}{HTML}{258F8F}
    \definecolor{ansi-white}{HTML}{C5C1B4}
    \definecolor{ansi-white-intense}{HTML}{A1A6B2}

    % commands and environments needed by pandoc snippets
    % extracted from the output of `pandoc -s`
    \providecommand{\tightlist}{%
      \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
    \DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
    % Add ',fontsize=\small' for more characters per line
    \newenvironment{Shaded}{}{}
    \newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{{#1}}}}
    \newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.56,0.13,0.00}{{#1}}}
    \newcommand{\DecValTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\FloatTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\CharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\StringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\CommentTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textit{{#1}}}}
    \newcommand{\OtherTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{{#1}}}
    \newcommand{\AlertTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
    \newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.02,0.16,0.49}{{#1}}}
    \newcommand{\RegionMarkerTok}[1]{{#1}}
    \newcommand{\ErrorTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
    \newcommand{\NormalTok}[1]{{#1}}
    
    % Additional commands for more recent versions of Pandoc
    \newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.53,0.00,0.00}{{#1}}}
    \newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.73,0.40,0.53}{{#1}}}
    \newcommand{\ImportTok}[1]{{#1}}
    \newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.73,0.13,0.13}{\textit{{#1}}}}
    \newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\VariableTok}[1]{\textcolor[rgb]{0.10,0.09,0.49}{{#1}}}
    \newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{{#1}}}}
    \newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.40,0.40,0.40}{{#1}}}
    \newcommand{\BuiltInTok}[1]{{#1}}
    \newcommand{\ExtensionTok}[1]{{#1}}
    \newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.74,0.48,0.00}{{#1}}}
    \newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.49,0.56,0.16}{{#1}}}
    \newcommand{\InformationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\WarningTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    
    
    % Define a nice break command that doesn't care if a line doesn't already
    % exist.
    \def\br{\hspace*{\fill} \\* }
    % Math Jax compatability definitions
    \def\gt{>}
    \def\lt{<}
    % Document parameters
    \title{Assignment\%201}
    
    
    

    % Pygments definitions
    
\makeatletter
\def\PY@reset{\let\PY@it=\relax \let\PY@bf=\relax%
    \let\PY@ul=\relax \let\PY@tc=\relax%
    \let\PY@bc=\relax \let\PY@ff=\relax}
\def\PY@tok#1{\csname PY@tok@#1\endcsname}
\def\PY@toks#1+{\ifx\relax#1\empty\else%
    \PY@tok{#1}\expandafter\PY@toks\fi}
\def\PY@do#1{\PY@bc{\PY@tc{\PY@ul{%
    \PY@it{\PY@bf{\PY@ff{#1}}}}}}}
\def\PY#1#2{\PY@reset\PY@toks#1+\relax+\PY@do{#2}}

\expandafter\def\csname PY@tok@w\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.73,0.73}{##1}}}
\expandafter\def\csname PY@tok@c\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@cp\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.74,0.48,0.00}{##1}}}
\expandafter\def\csname PY@tok@k\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kp\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kt\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.69,0.00,0.25}{##1}}}
\expandafter\def\csname PY@tok@o\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@ow\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.67,0.13,1.00}{##1}}}
\expandafter\def\csname PY@tok@nb\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@nf\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@nc\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@nn\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@ne\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.82,0.25,0.23}{##1}}}
\expandafter\def\csname PY@tok@nv\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@no\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.53,0.00,0.00}{##1}}}
\expandafter\def\csname PY@tok@nl\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.63,0.63,0.00}{##1}}}
\expandafter\def\csname PY@tok@ni\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.60,0.60,0.60}{##1}}}
\expandafter\def\csname PY@tok@na\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.49,0.56,0.16}{##1}}}
\expandafter\def\csname PY@tok@nt\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@nd\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.67,0.13,1.00}{##1}}}
\expandafter\def\csname PY@tok@s\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@sd\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@si\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.73,0.40,0.53}{##1}}}
\expandafter\def\csname PY@tok@se\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.73,0.40,0.13}{##1}}}
\expandafter\def\csname PY@tok@sr\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.40,0.53}{##1}}}
\expandafter\def\csname PY@tok@ss\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@sx\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@m\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@gh\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\expandafter\def\csname PY@tok@gu\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.50,0.00,0.50}{##1}}}
\expandafter\def\csname PY@tok@gd\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.63,0.00,0.00}{##1}}}
\expandafter\def\csname PY@tok@gi\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.63,0.00}{##1}}}
\expandafter\def\csname PY@tok@gr\endcsname{\def\PY@tc##1{\textcolor[rgb]{1.00,0.00,0.00}{##1}}}
\expandafter\def\csname PY@tok@ge\endcsname{\let\PY@it=\textit}
\expandafter\def\csname PY@tok@gs\endcsname{\let\PY@bf=\textbf}
\expandafter\def\csname PY@tok@gp\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\expandafter\def\csname PY@tok@go\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.53,0.53,0.53}{##1}}}
\expandafter\def\csname PY@tok@gt\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.27,0.87}{##1}}}
\expandafter\def\csname PY@tok@err\endcsname{\def\PY@bc##1{\setlength{\fboxsep}{0pt}\fcolorbox[rgb]{1.00,0.00,0.00}{1,1,1}{\strut ##1}}}
\expandafter\def\csname PY@tok@kc\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kd\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kn\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kr\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@bp\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@fm\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@vc\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@vg\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@vi\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@vm\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@sa\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@sb\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@sc\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@dl\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@s2\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@sh\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@s1\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@mb\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@mf\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@mh\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@mi\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@il\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@mo\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@ch\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@cm\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@cpf\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@c1\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@cs\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}

\def\PYZbs{\char`\\}
\def\PYZus{\char`\_}
\def\PYZob{\char`\{}
\def\PYZcb{\char`\}}
\def\PYZca{\char`\^}
\def\PYZam{\char`\&}
\def\PYZlt{\char`\<}
\def\PYZgt{\char`\>}
\def\PYZsh{\char`\#}
\def\PYZpc{\char`\%}
\def\PYZdl{\char`\$}
\def\PYZhy{\char`\-}
\def\PYZsq{\char`\'}
\def\PYZdq{\char`\"}
\def\PYZti{\char`\~}
% for compatibility with earlier versions
\def\PYZat{@}
\def\PYZlb{[}
\def\PYZrb{]}
\makeatother


    % Exact colors from NB
    \definecolor{incolor}{rgb}{0.0, 0.0, 0.5}
    \definecolor{outcolor}{rgb}{0.545, 0.0, 0.0}



    
    % Prevent overflowing lines due to hard-to-break entities
    \sloppy 
    % Setup hyperref package
    \hypersetup{
      breaklinks=true,  % so long urls are correctly broken across lines
      colorlinks=true,
      urlcolor=urlcolor,
      linkcolor=linkcolor,
      citecolor=citecolor,
      }
    % Slightly bigger margins than the latex defaults
    
    \geometry{verbose,tmargin=1in,bmargin=1in,lmargin=1in,rmargin=1in}
    
    

    \begin{document}
    
    
    \maketitle
    
    

    
    \section{CSE 252B: Computer Vision II, Winter 2019 -- Assignment
1}\label{cse-252b-computer-vision-ii-winter-2019-assignment-1}

\subsubsection{Instructor: Ben Ochoa}\label{instructor-ben-ochoa}

\subsubsection{Due: Wednesday, January 16, 2019, 11:59
PM}\label{due-wednesday-january-16-2019-1159-pm}

    \subsection{Instructions}\label{instructions}

\begin{itemize}
\tightlist
\item
  Review the academic integrity and collaboration policies on the course
  website.
\item
  This assignment must be completed individually.
\item
  This assignment contains both math and programming problems.
\item
  All solutions must be written in this notebook
\item
  Math problems must be done in Markdown/LATEX. Remember to show work
  and describe your solution.
\item
  Programming aspects of this assignment must be completed using Python
  in this notebook.
\item
  This notebook contains skeleton code, which should not be modified
  (This is important for standardization to facilate effeciant grading).
\item
  You may use python packages for basic linear algebra, but you may not
  use packages that directly solve the problem. Ask the instructor if in
  doubt.
\item
  You must submit this notebook exported as a pdf. You must also submit
  this notebook as an .ipynb file.
\item
  You must submit both files (.pdf and .ipynb) on Gradescope. You must
  mark each problem on Gradescope in the pdf.
\item
  It is highly recommended that you begin working on this assignment
  early.
\end{itemize}

    \section{Problem 1 (Programming): Feature detection (20
points)}\label{problem-1-programming-feature-detection-20-points}

Download input data from the course website. The file
price\_center20.JPG contains image 1 and the file price\_center21.JPG
contains image 2.

For each input image, calculate an image where each pixel value is the
minor eigenvalue of the gradient matrix

\(N=\left[ \begin{array}{cc} \sum\limits_w I_x^2 & \sum\limits_w I_x I_y\\ \sum\limits_w I_x I_y & \sum\limits_w I_y^2 \end{array} \right]\)

where w is the window about the pixel, and \(I_x\) and \(I_y\) are the
gradient images in the x and y direction, respectively. Calculate the
gradient images using the fivepoint central difference operator. Set
resulting values that are below a specified threshold value to zero
(hint: calculating the mean instead of the sum in N allows for adjusting
the size of the window without changing the threshold value). Apply an
operation that suppresses (sets to 0) local (i.e., about a window)
nonmaximum pixel values in the minor eigenvalue image. Vary these
parameters such that around 600--650 features are detected in each
image. For resulting nonzero pixel values, determine the subpixel
feature coordinate using the Forstner corner point operator.

\paragraph{Report your final values
for:}\label{report-your-final-values-for}

\begin{itemize}
\tightlist
\item
  the size of the feature detection window (i.e. the size of the window
  used to calculate the elements in the gradient matrix N)
\item
  the minor eigenvalue threshold value
\item
  the size of the local nonmaximum suppression window
\item
  the resulting number of features detected (i.e. corners) in each
  image.
\end{itemize}

\paragraph{Display figures for:}\label{display-figures-for}

\begin{itemize}
\tightlist
\item
  gradient image heat map before thresholding
\item
  gradient image heat map after thresholding
\item
  original image with detected features
\end{itemize}

My implementation takes around 25 seconds to run. If yours is more than
250 seconds you may lose points.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}1}]:} \PY{k}{def} \PY{n+nf}{grayscale}\PY{p}{(}\PY{n}{img}\PY{p}{)}\PY{p}{:}
            \PY{n}{gray}\PY{o}{=}\PY{n}{np}\PY{o}{.}\PY{n}{zeros}\PY{p}{(}\PY{p}{(}\PY{n}{img}\PY{o}{.}\PY{n}{shape}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{,}\PY{n}{img}\PY{o}{.}\PY{n}{shape}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}\PY{p}{)}
            \PY{n}{gray}\PY{o}{=}\PY{n}{img}\PY{p}{[}\PY{p}{:}\PY{p}{,}\PY{p}{:}\PY{p}{,}\PY{l+m+mi}{0}\PY{p}{]}\PY{o}{*}\PY{l+m+mf}{0.2989}\PY{o}{+}\PY{n}{img}\PY{p}{[}\PY{p}{:}\PY{p}{,}\PY{p}{:}\PY{p}{,}\PY{l+m+mi}{1}\PY{p}{]}\PY{o}{*}\PY{l+m+mf}{0.5870}\PY{o}{+}\PY{n}{img}\PY{p}{[}\PY{p}{:}\PY{p}{,}\PY{p}{:}\PY{p}{,}\PY{l+m+mi}{2}\PY{p}{]}\PY{o}{*}\PY{l+m+mf}{0.1140}
            \PY{k}{return} \PY{n}{gray}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}2}]:} \PY{o}{\PYZpc{}}\PY{k}{matplotlib} inline
        \PY{k+kn}{import} \PY{n+nn}{numpy} \PY{k}{as} \PY{n+nn}{np}
        \PY{k+kn}{from} \PY{n+nn}{PIL} \PY{k}{import} \PY{n}{Image}
        \PY{k+kn}{import} \PY{n+nn}{matplotlib}\PY{n+nn}{.}\PY{n+nn}{pyplot} \PY{k}{as} \PY{n+nn}{plt}
        \PY{k+kn}{import} \PY{n+nn}{matplotlib}\PY{n+nn}{.}\PY{n+nn}{patches} \PY{k}{as} \PY{n+nn}{patches}
        \PY{k+kn}{import} \PY{n+nn}{time}
        \PY{k+kn}{from} \PY{n+nn}{scipy}\PY{n+nn}{.}\PY{n+nn}{signal} \PY{k}{import} \PY{n}{convolve2d} \PY{k}{as} \PY{n}{conv2}
        
        \PY{c+c1}{\PYZsh{} open the input images}
        \PY{n}{I1} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{n}{Image}\PY{o}{.}\PY{n}{open}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{price\PYZus{}center20.JPG}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{,} \PY{n}{dtype}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{float}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{o}{/}\PY{l+m+mf}{255.}
        \PY{n}{I2} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{n}{Image}\PY{o}{.}\PY{n}{open}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{price\PYZus{}center21.JPG}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{,} \PY{n}{dtype}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{float}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{o}{/}\PY{l+m+mf}{255.}
        \PY{n}{I1\PYZus{}gray} \PY{o}{=} \PY{n}{grayscale}\PY{p}{(}\PY{n}{I1}\PY{p}{)}
        \PY{n}{I2\PYZus{}gray} \PY{o}{=} \PY{n}{grayscale}\PY{p}{(}\PY{n}{I2}\PY{p}{)}
        
        \PY{c+c1}{\PYZsh{} Display the input images}
        \PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{14}\PY{p}{,}\PY{l+m+mi}{8}\PY{p}{)}\PY{p}{)}
        \PY{n}{plt}\PY{o}{.}\PY{n}{subplot}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mi}{2}\PY{p}{,}\PY{l+m+mi}{1}\PY{p}{)}
        \PY{n}{plt}\PY{o}{.}\PY{n}{imshow}\PY{p}{(}\PY{n}{I1\PYZus{}gray}\PY{p}{)}
        \PY{n}{plt}\PY{o}{.}\PY{n}{subplot}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mi}{2}\PY{p}{,}\PY{l+m+mi}{2}\PY{p}{)}
        \PY{n}{plt}\PY{o}{.}\PY{n}{imshow}\PY{p}{(}\PY{n}{I2\PYZus{}gray}\PY{p}{)}
        \PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}


    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_4_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}3}]:} \PY{k}{def} \PY{n+nf}{ImageGradient}\PY{p}{(}\PY{n}{I}\PY{p}{,} \PY{n}{w}\PY{p}{,} \PY{n}{t}\PY{p}{)}\PY{p}{:}
            \PY{c+c1}{\PYZsh{} inputs: }
            \PY{c+c1}{\PYZsh{} I is the input image (may be mxn for Grayscale or mxnx3 for RGB)}
            \PY{c+c1}{\PYZsh{} w is the size of the window used to compute the gradient matrix N}
            \PY{c+c1}{\PYZsh{} t is the minor eigenvalue threshold}
            \PY{c+c1}{\PYZsh{}}
            \PY{c+c1}{\PYZsh{} outputs:}
            \PY{c+c1}{\PYZsh{} N is the 2x2xmxn gradient matrix}
            \PY{c+c1}{\PYZsh{} b in the 2x1xmxn vector used in the Forstner corner detector}
            \PY{c+c1}{\PYZsh{} J0 is the mxn minor eigenvalue image of N before thresholding}
            \PY{c+c1}{\PYZsh{} J1 is the mxn minor eigenvalue image of N after thresholding}
            
            \PY{n}{m}\PY{p}{,}\PY{n}{n} \PY{o}{=} \PY{n}{I}\PY{o}{.}\PY{n}{shape}\PY{p}{[}\PY{p}{:}\PY{l+m+mi}{2}\PY{p}{]}
            \PY{n}{N} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{zeros}\PY{p}{(}\PY{p}{(}\PY{l+m+mi}{2}\PY{p}{,}\PY{l+m+mi}{2}\PY{p}{,}\PY{n}{m}\PY{p}{,}\PY{n}{n}\PY{p}{)}\PY{p}{)}
            \PY{n}{b} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{zeros}\PY{p}{(}\PY{p}{(}\PY{l+m+mi}{2}\PY{p}{,}\PY{l+m+mi}{1}\PY{p}{,}\PY{n}{m}\PY{p}{,}\PY{n}{n}\PY{p}{)}\PY{p}{)}
            \PY{n}{J0} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{zeros}\PY{p}{(}\PY{p}{(}\PY{n}{m}\PY{p}{,}\PY{n}{n}\PY{p}{)}\PY{p}{)}
            \PY{n}{J1} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{zeros}\PY{p}{(}\PY{p}{(}\PY{n}{m}\PY{p}{,}\PY{n}{n}\PY{p}{)}\PY{p}{)}
            
            \PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}your code here\PYZdq{}\PYZdq{}\PYZdq{}}
            \PY{c+c1}{\PYZsh{}Compute gradient}
            \PY{n}{kernel\PYZus{}5pts} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{p}{[}\PY{p}{[}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mi}{8}\PY{p}{,}\PY{l+m+mi}{0}\PY{p}{,}\PY{o}{\PYZhy{}}\PY{l+m+mi}{8}\PY{p}{,}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{]}\PY{p}{)}\PY{o}{.}\PY{n}{T}\PY{o}{/}\PY{l+m+mi}{12}
            
            \PY{n}{I\PYZus{}dx} \PY{o}{=} \PY{n}{conv2}\PY{p}{(}\PY{n}{I}\PY{p}{,} \PY{n}{kernel\PYZus{}5pts}\PY{o}{.}\PY{n}{T}\PY{p}{,}\PY{n}{mode} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{same}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
            \PY{n}{I\PYZus{}dy} \PY{o}{=} \PY{n}{conv2}\PY{p}{(}\PY{n}{I}\PY{p}{,} \PY{n}{kernel\PYZus{}5pts}\PY{p}{,}\PY{n}{mode} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{same}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
            
            \PY{n}{WTH} \PY{o}{=} \PY{n}{I}\PY{o}{.}\PY{n}{shape}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}
            \PY{n}{LTH} \PY{o}{=} \PY{n}{I}\PY{o}{.}\PY{n}{shape}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}
            \PY{n}{m} \PY{o}{=} \PY{n}{LTH}
            \PY{n}{n} \PY{o}{=} \PY{n}{WTH}
            \PY{n}{c\PYZus{}x} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{zeros}\PY{p}{(}\PY{n}{w}\PY{p}{)}
            \PY{n}{c\PYZus{}y} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{zeros}\PY{p}{(}\PY{n}{w}\PY{p}{)}
            \PY{n}{r} \PY{o}{=} \PY{n+nb}{int}\PY{p}{(}\PY{n}{w}\PY{o}{/}\PY{l+m+mi}{2}\PY{p}{)}
            \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range} \PY{p}{(}\PY{n}{r}\PY{p}{,} \PY{n}{WTH}\PY{o}{\PYZhy{}}\PY{n}{r}\PY{p}{)}\PY{p}{:}
                \PY{k}{for} \PY{n}{j} \PY{o+ow}{in} \PY{n+nb}{range} \PY{p}{(}\PY{n}{r}\PY{p}{,} \PY{n}{LTH}\PY{o}{\PYZhy{}}\PY{n}{r}\PY{p}{)}\PY{p}{:}
                    \PY{n}{N}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{,}\PY{l+m+mi}{0}\PY{p}{,}\PY{n}{j}\PY{p}{,}\PY{n}{i}\PY{p}{]} \PY{o}{=} \PY{p}{(}\PY{n}{I\PYZus{}dx}\PY{p}{[}\PY{n}{j}\PY{o}{\PYZhy{}}\PY{n}{r}\PY{p}{:}\PY{n}{j}\PY{o}{+}\PY{n}{r}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{,}\PY{n}{i}\PY{o}{\PYZhy{}}\PY{n}{r}\PY{p}{:}\PY{n}{i}\PY{o}{+}\PY{n}{r}\PY{o}{+}\PY{l+m+mi}{1} \PY{p}{]}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2}\PY{p}{)}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{p}{)}\PY{c+c1}{\PYZsh{}/(w**2)}
                    \PY{n}{N}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{,}\PY{l+m+mi}{1}\PY{p}{,}\PY{n}{j}\PY{p}{,}\PY{n}{i}\PY{p}{]} \PY{o}{=} \PY{p}{(}\PY{n}{I\PYZus{}dx}\PY{p}{[}\PY{n}{j}\PY{o}{\PYZhy{}}\PY{n}{r}\PY{p}{:}\PY{n}{j}\PY{o}{+}\PY{n}{r}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{,}
                                       \PY{n}{i}\PY{o}{\PYZhy{}}\PY{n}{r}\PY{p}{:}\PY{n}{i}\PY{o}{+}\PY{n}{r}\PY{o}{+}\PY{l+m+mi}{1} \PY{p}{]}\PY{o}{*} \PY{n}{I\PYZus{}dy}\PY{p}{[}\PY{n}{j}\PY{o}{\PYZhy{}}\PY{n}{r}\PY{p}{:}\PY{n}{j}\PY{o}{+}\PY{n}{r}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{,}
                                                       \PY{n}{i}\PY{o}{\PYZhy{}}\PY{n}{r}\PY{p}{:}\PY{n}{i}\PY{o}{+}\PY{n}{r}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{p}{)}\PY{c+c1}{\PYZsh{}/(w**2)}
                    \PY{n}{N}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mi}{0}\PY{p}{,}\PY{n}{j}\PY{p}{,}\PY{n}{i}\PY{p}{]} \PY{o}{=} \PY{n}{N}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{,}\PY{l+m+mi}{1}\PY{p}{,}\PY{n}{j}\PY{p}{,}\PY{n}{i}\PY{p}{]}
                    \PY{n}{N}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mi}{1}\PY{p}{,}\PY{n}{j}\PY{p}{,}\PY{n}{i}\PY{p}{]} \PY{o}{=} \PY{p}{(}\PY{n}{I\PYZus{}dy}\PY{p}{[}\PY{n}{j}\PY{o}{\PYZhy{}}\PY{n}{r}\PY{p}{:}\PY{n}{j}\PY{o}{+}\PY{n}{r}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{,}
                                       \PY{n}{i}\PY{o}{\PYZhy{}}\PY{n}{r}\PY{p}{:}\PY{n}{i}\PY{o}{+}\PY{n}{r}\PY{o}{+}\PY{l+m+mi}{1} \PY{p}{]}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2}\PY{p}{)}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{p}{)}\PY{c+c1}{\PYZsh{}/(w**2)}
                    
                
                    \PY{n}{c\PYZus{}x} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{p}{[}\PY{n}{np}\PY{o}{.}\PY{n}{arange}\PY{p}{(}\PY{n}{i}\PY{o}{\PYZhy{}}\PY{n}{r} \PY{p}{,} \PY{n}{i}\PY{o}{+}\PY{n}{r}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{,}\PY{p}{]}\PY{o}{*}\PY{n}{w}\PY{p}{)}
                    \PY{n}{c\PYZus{}y} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{p}{[}\PY{n}{np}\PY{o}{.}\PY{n}{arange}\PY{p}{(}\PY{n}{j}\PY{o}{\PYZhy{}}\PY{n}{r} \PY{p}{,} \PY{n}{j}\PY{o}{+}\PY{n}{r}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{,}\PY{p}{]}\PY{o}{*}\PY{n}{w}\PY{p}{)}\PY{o}{.}\PY{n}{T}
                    
                    \PY{n}{b}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{,}\PY{l+m+mi}{0}\PY{p}{,}\PY{n}{j}\PY{p}{,}\PY{n}{i}\PY{p}{]} \PY{o}{=} \PY{p}{(}\PY{n}{c\PYZus{}x}\PY{o}{*}\PY{n}{I\PYZus{}dx}\PY{p}{[}\PY{n}{j}\PY{o}{\PYZhy{}}\PY{n}{r}\PY{p}{:}\PY{n}{j}\PY{o}{+}\PY{n}{r}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{,}
                                          \PY{n}{i}\PY{o}{\PYZhy{}}\PY{n}{r}\PY{p}{:}\PY{n}{i}\PY{o}{+}\PY{n}{r}\PY{o}{+}\PY{l+m+mi}{1} \PY{p}{]}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2}\PY{p}{)}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{p}{)} \PY{o}{+} \PY{p}{(}\PY{n}{c\PYZus{}y} \PY{o}{*} \PY{p}{(}\PY{n}{I\PYZus{}dx}\PY{p}{[}\PY{n}{j}\PY{o}{\PYZhy{}}\PY{n}{r}\PY{p}{:}\PY{n}{j}\PY{o}{+}\PY{n}{r}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{,}
                                                                     \PY{n}{i}\PY{o}{\PYZhy{}}\PY{n}{r}\PY{p}{:}\PY{n}{i}\PY{o}{+}\PY{n}{r}\PY{o}{+}\PY{l+m+mi}{1} \PY{p}{]}\PY{o}{*} \PY{n}{I\PYZus{}dy}\PY{p}{[}\PY{n}{j}\PY{o}{\PYZhy{}}\PY{n}{r}\PY{p}{:}\PY{n}{j}\PY{o}{+}\PY{n}{r}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{,}\PY{n}{i}\PY{o}{\PYZhy{}}\PY{n}{r}\PY{p}{:}\PY{n}{i}\PY{o}{+}\PY{n}{r}\PY{o}{+}\PY{l+m+mi}{1} \PY{p}{]}\PY{p}{)}\PY{p}{)}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{p}{)}
                    
                    
                    \PY{n}{b}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mi}{0}\PY{p}{,}\PY{n}{j}\PY{p}{,}\PY{n}{i}\PY{p}{]} \PY{o}{=} \PY{p}{(}\PY{n}{c\PYZus{}y}\PY{o}{*}\PY{n}{I\PYZus{}dy}\PY{p}{[}\PY{n}{j}\PY{o}{\PYZhy{}}\PY{n}{r}\PY{p}{:}\PY{n}{j}\PY{o}{+}\PY{n}{r}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{,}
                                          \PY{n}{i}\PY{o}{\PYZhy{}}\PY{n}{r}\PY{p}{:}\PY{n}{i}\PY{o}{+}\PY{n}{r}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{]}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2}\PY{p}{)}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{p}{)} \PY{o}{+} \PY{p}{(}\PY{n}{c\PYZus{}x} \PY{o}{*} \PY{p}{(}\PY{n}{I\PYZus{}dx}\PY{p}{[}\PY{n}{j}\PY{o}{\PYZhy{}}\PY{n}{r}\PY{p}{:}\PY{n}{j}\PY{o}{+}\PY{n}{r}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{,}
                                                                         \PY{n}{i}\PY{o}{\PYZhy{}}\PY{n}{r}\PY{p}{:}\PY{n}{i}\PY{o}{+}\PY{n}{r}\PY{o}{+}\PY{l+m+mi}{1} \PY{p}{]}\PY{o}{*} \PY{n}{I\PYZus{}dy}\PY{p}{[}\PY{n}{j}\PY{o}{\PYZhy{}}\PY{n}{r}\PY{p}{:}\PY{n}{j}\PY{o}{+}\PY{n}{r}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{,}
                                                                                             \PY{n}{i}\PY{o}{\PYZhy{}}\PY{n}{r}\PY{p}{:}\PY{n}{i}\PY{o}{+}\PY{n}{r}\PY{o}{+}\PY{l+m+mi}{1} \PY{p}{]}\PY{p}{)}\PY{p}{)}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{p}{)}
                    
                    
                    \PY{c+c1}{\PYZsh{}J0 before threshold, J1 after threshod }
                    \PY{n}{J0}\PY{p}{[}\PY{n}{j}\PY{p}{,}\PY{n}{i}\PY{p}{]} \PY{o}{=} \PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{trace}\PY{p}{(}\PY{n}{N}\PY{p}{[}\PY{p}{:}\PY{p}{,}\PY{p}{:}\PY{p}{,}\PY{n}{j}\PY{p}{,}\PY{n}{i}\PY{p}{]}\PY{o}{/}\PY{p}{(}\PY{n}{w}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2}\PY{p}{)}\PY{p}{)}\PY{o}{\PYZhy{}} \PY{n}{np}\PY{o}{.}\PY{n}{sqrt}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{around}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{trace}\PY{p}{(}\PY{n}{N}\PY{p}{[}\PY{p}{:}\PY{p}{,}\PY{p}{:}\PY{p}{,}\PY{n}{j}\PY{p}{,}\PY{n}{i}\PY{p}{]}\PY{o}{/}\PY{p}{(}\PY{n}{w}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2}\PY{p}{)}\PY{p}{)}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2}\PY{p}{,}\PY{l+m+mi}{9}\PY{p}{)}
                                                             \PY{o}{\PYZhy{}}\PY{n}{np}\PY{o}{.}\PY{n}{around}\PY{p}{(}\PY{l+m+mi}{4}\PY{o}{*}\PY{n}{np}\PY{o}{.}\PY{n}{linalg}\PY{o}{.}\PY{n}{det}\PY{p}{(}\PY{n}{N}\PY{p}{[}\PY{p}{:}\PY{p}{,}\PY{p}{:}\PY{p}{,}\PY{n}{j}\PY{p}{,}\PY{n}{i}\PY{p}{]}\PY{o}{/}\PY{p}{(}\PY{n}{w}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2}\PY{p}{)}\PY{p}{)}\PY{p}{,}\PY{l+m+mi}{9}\PY{p}{)}\PY{p}{)}\PY{p}{)}\PY{o}{/}\PY{l+m+mi}{2}
            
            
            \PY{n}{J1} \PY{o}{=} \PY{n}{J0}\PY{o}{.}\PY{n}{copy}\PY{p}{(}\PY{p}{)}
            
            \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range} \PY{p}{(}\PY{n}{WTH}\PY{p}{)}\PY{p}{:}
                \PY{k}{for} \PY{n}{j} \PY{o+ow}{in} \PY{n+nb}{range} \PY{p}{(}\PY{n}{LTH}\PY{p}{)}\PY{p}{:}
                    \PY{k}{if} \PY{n}{J1}\PY{p}{[}\PY{n}{j}\PY{p}{,}\PY{n}{i}\PY{p}{]} \PY{o}{\PYZlt{}} \PY{n}{t}\PY{p}{:} 
                        \PY{n}{J1}\PY{p}{[}\PY{n}{j}\PY{p}{,}\PY{n}{i}\PY{p}{]} \PY{o}{=} \PY{l+m+mi}{0}
            
            \PY{k}{return} \PY{n}{N}\PY{p}{,} \PY{n}{b}\PY{p}{,} \PY{n}{J0}\PY{p}{,} \PY{n}{J1}
        
        \PY{k}{def} \PY{n+nf}{NMS}\PY{p}{(}\PY{n}{J}\PY{p}{,} \PY{n}{w\PYZus{}nms}\PY{p}{)}\PY{p}{:}
            \PY{c+c1}{\PYZsh{} Apply nonmaximum supression to J using window w}
            \PY{c+c1}{\PYZsh{} For any window in J, the result should only contain 1 nonzero value}
            \PY{c+c1}{\PYZsh{} In the case of multiple identical maxima in the same window,}
            \PY{c+c1}{\PYZsh{} the tie may be broken arbitrarily}
            \PY{c+c1}{\PYZsh{}}
            \PY{c+c1}{\PYZsh{} inputs: }
            \PY{c+c1}{\PYZsh{} J is the minor eigenvalue image input image after thresholding}
            \PY{c+c1}{\PYZsh{} w\PYZus{}nms is the size of the local nonmaximum suppression window}
            \PY{c+c1}{\PYZsh{} }
            \PY{c+c1}{\PYZsh{} outputs:}
            \PY{c+c1}{\PYZsh{} J2 is the mxn resulting image after applying nonmaximum suppression}
            \PY{c+c1}{\PYZsh{} }
            \PY{n}{WTH} \PY{o}{=} \PY{n}{J}\PY{o}{.}\PY{n}{shape}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}
            \PY{n}{LTH} \PY{o}{=} \PY{n}{J}\PY{o}{.}\PY{n}{shape}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}
            \PY{n}{r} \PY{o}{=} \PY{n+nb}{int}\PY{p}{(}\PY{n}{w\PYZus{}nms}\PY{o}{/}\PY{l+m+mi}{2}\PY{p}{)}
            
            \PY{n}{J2} \PY{o}{=} \PY{n}{J}\PY{o}{.}\PY{n}{copy}\PY{p}{(}\PY{p}{)}
            \PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}your code here\PYZdq{}\PYZdq{}\PYZdq{}}
            \PY{n}{r} \PY{o}{=} \PY{n+nb}{int}\PY{p}{(}\PY{n}{w}\PY{o}{/}\PY{l+m+mi}{2}\PY{p}{)}
            \PY{n}{pos} \PY{o}{=} \PY{p}{[}\PY{p}{]}
            \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range} \PY{p}{(}\PY{n}{r}\PY{p}{,}\PY{n}{WTH}\PY{o}{\PYZhy{}}\PY{n}{r}\PY{p}{)}\PY{p}{:}
                \PY{k}{for} \PY{n}{j} \PY{o+ow}{in} \PY{n+nb}{range} \PY{p}{(}\PY{n}{r}\PY{p}{,} \PY{n}{LTH}\PY{o}{\PYZhy{}}\PY{n}{r}\PY{p}{)}\PY{p}{:}
                    \PY{n}{local\PYZus{}max} \PY{o}{=} \PY{n}{J}\PY{p}{[}\PY{n}{j}\PY{o}{\PYZhy{}}\PY{n}{r}\PY{p}{:}\PY{n}{j}\PY{o}{+}\PY{n}{r}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{,}\PY{n}{i}\PY{o}{\PYZhy{}}\PY{n}{r}\PY{p}{:}\PY{n}{i}\PY{o}{+}\PY{n}{r}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{]}\PY{o}{.}\PY{n}{max}\PY{p}{(}\PY{p}{)}
                    \PY{k}{if} \PY{n}{local\PYZus{}max} \PY{o}{\PYZgt{}} \PY{n}{J2}\PY{p}{[}\PY{n}{j}\PY{p}{,}\PY{n}{i}\PY{p}{]}\PY{p}{:}
                        \PY{n}{J2}\PY{p}{[}\PY{n}{j}\PY{p}{,}\PY{n}{i}\PY{p}{]} \PY{o}{=} \PY{l+m+mi}{0}
        
            \PY{k}{return} \PY{n}{J2}
          
            
        \PY{k}{def} \PY{n+nf}{ForstnerCornerDetector}\PY{p}{(}\PY{n}{J}\PY{p}{,} \PY{n}{N}\PY{p}{,} \PY{n}{b}\PY{p}{)}\PY{p}{:}
            \PY{c+c1}{\PYZsh{} Gather the coordinates of the nonzero pixels in J }
            \PY{c+c1}{\PYZsh{} Then compute the sub pixel location of each point using the Forstner operator}
            \PY{c+c1}{\PYZsh{}}
            \PY{c+c1}{\PYZsh{} inputs:}
            \PY{c+c1}{\PYZsh{} J is the NMS image}
            \PY{c+c1}{\PYZsh{} N is the 2x2xmxn gradient matrix}
            \PY{c+c1}{\PYZsh{} b is the 2x1xmxn vector computed in the image\PYZus{}gradient function}
            \PY{c+c1}{\PYZsh{}}
            \PY{c+c1}{\PYZsh{} outputs:}
            \PY{c+c1}{\PYZsh{} C is the number of corners detected in each image}
            \PY{c+c1}{\PYZsh{} pts is the 2xC list of coordinates of subpixel accurate corners}
            \PY{c+c1}{\PYZsh{}     found using the Forstner corner detector}
            
            \PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}your code here\PYZdq{}\PYZdq{}\PYZdq{}}
            \PY{n}{WTH} \PY{o}{=} \PY{n}{J}\PY{o}{.}\PY{n}{shape}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}
            \PY{n}{LTH} \PY{o}{=} \PY{n}{J}\PY{o}{.}\PY{n}{shape}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}
            \PY{n}{pos} \PY{o}{=} \PY{p}{[}\PY{p}{]}
            \PY{k}{for} \PY{n}{j} \PY{o+ow}{in} \PY{n+nb}{range} \PY{p}{(}\PY{n}{J}\PY{o}{.}\PY{n}{shape}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{)}\PY{p}{:}
                \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range} \PY{p}{(}\PY{n}{J}\PY{o}{.}\PY{n}{shape}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}\PY{p}{:}
                    \PY{k}{if} \PY{n}{J}\PY{p}{[}\PY{n}{j}\PY{p}{,}\PY{n}{i}\PY{p}{]} \PY{o}{!=} \PY{l+m+mi}{0}\PY{p}{:}
                        \PY{n}{pos}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{p}{[}\PY{n}{j}\PY{p}{,}\PY{n}{i}\PY{p}{]}\PY{p}{)}
            
            \PY{n}{pos\PYZus{}np} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{n}{pos}\PY{p}{)}
            
            \PY{n}{C} \PY{o}{=} \PY{n}{pos\PYZus{}np}\PY{o}{.}\PY{n}{shape}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}
            \PY{n}{pts} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{zeros}\PY{p}{(}\PY{p}{(}\PY{l+m+mi}{2}\PY{p}{,}\PY{n}{C}\PY{p}{)}\PY{p}{)}
            
            
            
            \PY{k}{for} \PY{n}{k}\PY{p}{,} \PY{p}{(}\PY{n}{j}\PY{p}{,} \PY{n}{i}\PY{p}{)} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n+nb}{zip} \PY{p}{(}\PY{n}{pos\PYZus{}np}\PY{p}{[}\PY{p}{:}\PY{p}{,}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{,}\PY{n}{pos\PYZus{}np}\PY{p}{[}\PY{p}{:}\PY{p}{,}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}\PY{p}{)}\PY{p}{:} 
                \PY{k}{if} \PY{n}{np}\PY{o}{.}\PY{n}{linalg}\PY{o}{.}\PY{n}{det}\PY{p}{(}\PY{n}{N}\PY{p}{[}\PY{p}{:}\PY{p}{,}\PY{p}{:}\PY{p}{,}\PY{n}{j}\PY{p}{,}\PY{n}{i}\PY{p}{]}\PY{p}{)} \PY{o}{!=} \PY{l+m+mi}{0} \PY{p}{:}
                        \PY{n}{pts}\PY{p}{[}\PY{p}{:}\PY{p}{,}\PY{n}{k}\PY{p}{]} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{dot}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{linalg}\PY{o}{.}\PY{n}{inv}\PY{p}{(}\PY{n}{N}\PY{p}{[}\PY{p}{:}\PY{p}{,}\PY{p}{:}\PY{p}{,}\PY{n}{j}\PY{p}{,}\PY{n}{i}\PY{p}{]}\PY{p}{)}\PY{p}{,}\PY{n}{b}\PY{p}{[}\PY{p}{:}\PY{p}{,}\PY{p}{:}\PY{p}{,}\PY{n}{j}\PY{p}{,}\PY{n}{i}\PY{p}{]}\PY{p}{)}\PY{o}{.}\PY{n}{reshape}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}
                  
                \PY{k}{else} \PY{p}{:}
                        \PY{c+c1}{\PYZsh{}b[:,:,j,i] = np.matrix(b[:,:,j,i])}
                        \PY{n}{pts}\PY{p}{[}\PY{p}{:}\PY{p}{,}\PY{n}{k}\PY{p}{]} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{dot}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{linalg}\PY{o}{.}\PY{n}{pinv}\PY{p}{(}\PY{n}{N}\PY{p}{[}\PY{p}{:}\PY{p}{,}\PY{p}{:}\PY{p}{,}\PY{n}{j}\PY{p}{,}\PY{n}{i}\PY{p}{]}\PY{p}{)} \PY{p}{,}\PY{n}{b}\PY{p}{[}\PY{p}{:}\PY{p}{,}\PY{p}{:}\PY{p}{,}\PY{n}{j}\PY{p}{,}\PY{n}{i}\PY{p}{]}\PY{p}{)}\PY{o}{.}\PY{n}{reshape}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}
        
            
            
            \PY{k}{return} \PY{n}{C}\PY{p}{,} \PY{n}{pts}\PY{p}{,}\PY{n}{pos\PYZus{}np}
        
        
        \PY{c+c1}{\PYZsh{} feature detection}
        \PY{k}{def} \PY{n+nf}{RunFeatureDetection}\PY{p}{(}\PY{n}{I}\PY{p}{,} \PY{n}{w}\PY{p}{,} \PY{n}{t}\PY{p}{,} \PY{n}{w\PYZus{}nms}\PY{p}{)}\PY{p}{:}
            \PY{n}{N}\PY{p}{,} \PY{n}{b}\PY{p}{,} \PY{n}{J0}\PY{p}{,} \PY{n}{J1} \PY{o}{=} \PY{n}{ImageGradient}\PY{p}{(}\PY{n}{I}\PY{p}{,} \PY{n}{w}\PY{p}{,} \PY{n}{t}\PY{p}{)}
            \PY{n}{J2} \PY{o}{=} \PY{n}{NMS}\PY{p}{(}\PY{n}{J1}\PY{p}{,} \PY{n}{w\PYZus{}nms}\PY{p}{)}
            \PY{n}{C}\PY{p}{,} \PY{n}{pts}\PY{p}{,}\PY{n}{pos} \PY{o}{=} \PY{n}{ForstnerCornerDetector}\PY{p}{(}\PY{n}{J2}\PY{p}{,} \PY{n}{N}\PY{p}{,} \PY{n}{b}\PY{p}{)}
            \PY{k}{return} \PY{n}{C}\PY{p}{,} \PY{n}{pts}\PY{p}{,} \PY{n}{J0}\PY{p}{,} \PY{n}{J1}\PY{p}{,} \PY{n}{J2}\PY{p}{,}\PY{n}{N}\PY{p}{,}\PY{n}{b}\PY{p}{,}\PY{n}{pos}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}4}]:} \PY{c+c1}{\PYZsh{} input images}
        \PY{l+s+sd}{\PYZsq{}\PYZsq{}\PYZsq{}}
        \PY{l+s+sd}{w = 7}
        \PY{l+s+sd}{t1 = 8*10**\PYZhy{}4}
        \PY{l+s+sd}{t2 = 8*10**\PYZhy{}4}
        \PY{l+s+sd}{w\PYZus{}nms = 7}
        \PY{l+s+sd}{8.3 \PYZhy{}\PYZhy{}\PYZhy{} 606/632}
        \PY{l+s+sd}{8.7 \PYZhy{}\PYZhy{} /621}
        \PY{l+s+sd}{\PYZsq{}\PYZsq{}\PYZsq{}}
        \PY{n}{I1} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{n}{Image}\PY{o}{.}\PY{n}{open}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{price\PYZus{}center20.JPG}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{,} \PY{n}{dtype}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{float}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{o}{/}\PY{l+m+mf}{255.}
        \PY{n}{I2} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{n}{Image}\PY{o}{.}\PY{n}{open}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{price\PYZus{}center21.JPG}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{,} \PY{n}{dtype}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{float}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{o}{/}\PY{l+m+mf}{255.}
        \PY{n}{I1\PYZus{}gray} \PY{o}{=} \PY{n}{grayscale}\PY{p}{(}\PY{n}{I1}\PY{p}{)}
        \PY{n}{I2\PYZus{}gray} \PY{o}{=} \PY{n}{grayscale}\PY{p}{(}\PY{n}{I2}\PY{p}{)}
        \PY{c+c1}{\PYZsh{} parameters to tune}
        \PY{n}{w} \PY{o}{=} \PY{l+m+mi}{7}
        \PY{n}{t1} \PY{o}{=} \PY{l+m+mf}{8.3}\PY{o}{*}\PY{l+m+mi}{10}\PY{o}{*}\PY{o}{*}\PY{o}{\PYZhy{}}\PY{l+m+mi}{4}
        \PY{n}{t2} \PY{o}{=} \PY{l+m+mf}{8.7}\PY{o}{*}\PY{l+m+mi}{10}\PY{o}{*}\PY{o}{*}\PY{o}{\PYZhy{}}\PY{l+m+mi}{4}
        \PY{n}{w\PYZus{}nms} \PY{o}{=} \PY{l+m+mi}{7}
        
        \PY{n}{tic} \PY{o}{=} \PY{n}{time}\PY{o}{.}\PY{n}{time}\PY{p}{(}\PY{p}{)}
        \PY{c+c1}{\PYZsh{} run feature detection algorithm on input images}
        \PY{n}{C1}\PY{p}{,} \PY{n}{pts1}\PY{p}{,} \PY{n}{J1\PYZus{}0}\PY{p}{,} \PY{n}{J1\PYZus{}1}\PY{p}{,} \PY{n}{J1\PYZus{}2}\PY{p}{,}\PY{n}{N1}\PY{p}{,}\PY{n}{b1}\PY{p}{,}\PY{n}{pos1} \PY{o}{=} \PY{n}{RunFeatureDetection}\PY{p}{(}\PY{n}{I1\PYZus{}gray}\PY{p}{,} \PY{n}{w}\PY{p}{,} \PY{n}{t1}\PY{p}{,} \PY{n}{w\PYZus{}nms}\PY{p}{)}
        \PY{n}{C2}\PY{p}{,} \PY{n}{pts2}\PY{p}{,} \PY{n}{J2\PYZus{}0}\PY{p}{,} \PY{n}{J2\PYZus{}1}\PY{p}{,} \PY{n}{J2\PYZus{}2}\PY{p}{,}\PY{n}{N2}\PY{p}{,}\PY{n}{b2}\PY{p}{,}\PY{n}{pos2} \PY{o}{=} \PY{n}{RunFeatureDetection}\PY{p}{(}\PY{n}{I2\PYZus{}gray}\PY{p}{,} \PY{n}{w}\PY{p}{,} \PY{n}{t2}\PY{p}{,} \PY{n}{w\PYZus{}nms}\PY{p}{)}
        \PY{n}{toc} \PY{o}{=} \PY{n}{time}\PY{o}{.}\PY{n}{time}\PY{p}{(}\PY{p}{)} \PY{o}{\PYZhy{}} \PY{n}{tic}
        
        \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{took }\PY{l+s+si}{\PYZpc{}f}\PY{l+s+s1}{ secs}\PY{l+s+s1}{\PYZsq{}}\PY{o}{\PYZpc{}}\PY{k}{toc})
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
took 87.442113 secs

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}5}]:} \PY{c+c1}{\PYZsh{} display results}
        \PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{14}\PY{p}{,}\PY{l+m+mi}{24}\PY{p}{)}\PY{p}{)}
        
        \PY{c+c1}{\PYZsh{} show pre\PYZhy{}thresholded corner heat map from gradient image function}
        \PY{n}{plt}\PY{o}{.}\PY{n}{subplot}\PY{p}{(}\PY{l+m+mi}{3}\PY{p}{,}\PY{l+m+mi}{2}\PY{p}{,}\PY{l+m+mi}{1}\PY{p}{)}
        \PY{n}{plt}\PY{o}{.}\PY{n}{imshow}\PY{p}{(}\PY{n}{J1\PYZus{}0}\PY{p}{,} \PY{n}{cmap}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{gray}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
        \PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{pre\PYZhy{}thresholded gradient image}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
        \PY{n}{plt}\PY{o}{.}\PY{n}{subplot}\PY{p}{(}\PY{l+m+mi}{3}\PY{p}{,}\PY{l+m+mi}{2}\PY{p}{,}\PY{l+m+mi}{2}\PY{p}{)}
        \PY{n}{plt}\PY{o}{.}\PY{n}{imshow}\PY{p}{(}\PY{n}{J2\PYZus{}0}\PY{p}{,} \PY{n}{cmap}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{gray}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
        \PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{pre\PYZhy{}thresholded gradient image}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
        
        \PY{c+c1}{\PYZsh{} show thresholded corner heat map from gradient image function}
        \PY{n}{plt}\PY{o}{.}\PY{n}{subplot}\PY{p}{(}\PY{l+m+mi}{3}\PY{p}{,}\PY{l+m+mi}{2}\PY{p}{,}\PY{l+m+mi}{3}\PY{p}{)}
        \PY{n}{plt}\PY{o}{.}\PY{n}{imshow}\PY{p}{(}\PY{n}{J1\PYZus{}1}\PY{p}{,} \PY{n}{cmap}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{gray}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
        \PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{thresholded gradient image}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
        \PY{n}{plt}\PY{o}{.}\PY{n}{subplot}\PY{p}{(}\PY{l+m+mi}{3}\PY{p}{,}\PY{l+m+mi}{2}\PY{p}{,}\PY{l+m+mi}{4}\PY{p}{)}
        \PY{n}{plt}\PY{o}{.}\PY{n}{imshow}\PY{p}{(}\PY{n}{J2\PYZus{}1}\PY{p}{,} \PY{n}{cmap}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{gray}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
        \PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{thresholded gradient image}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
        
        \PY{c+c1}{\PYZsh{} show corners on original images}
        \PY{n}{ax} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplot}\PY{p}{(}\PY{l+m+mi}{3}\PY{p}{,}\PY{l+m+mi}{2}\PY{p}{,}\PY{l+m+mi}{5}\PY{p}{)}
        \PY{n}{plt}\PY{o}{.}\PY{n}{imshow}\PY{p}{(}\PY{n}{I1}\PY{p}{)}
        \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{C1}\PY{p}{)}\PY{p}{:} \PY{c+c1}{\PYZsh{} draw rectangles of size w around corners}
            \PY{n}{x}\PY{p}{,}\PY{n}{y} \PY{o}{=} \PY{n}{pts1}\PY{p}{[}\PY{p}{:}\PY{p}{,}\PY{n}{i}\PY{p}{]}
            \PY{n}{ax}\PY{o}{.}\PY{n}{add\PYZus{}patch}\PY{p}{(}\PY{n}{patches}\PY{o}{.}\PY{n}{Rectangle}\PY{p}{(}\PY{p}{(}\PY{n}{x}\PY{o}{\PYZhy{}}\PY{n}{w}\PY{o}{/}\PY{l+m+mi}{2}\PY{p}{,}\PY{n}{y}\PY{o}{\PYZhy{}}\PY{n}{w}\PY{o}{/}\PY{l+m+mi}{2}\PY{p}{)}\PY{p}{,}\PY{n}{w}\PY{p}{,}\PY{n}{w}\PY{p}{,} \PY{n}{fill}\PY{o}{=}\PY{k+kc}{False}\PY{p}{)}\PY{p}{)}
        \PY{c+c1}{\PYZsh{} plt.plot(pts1[0,:], pts1[1,:], \PYZsq{}.b\PYZsq{}) \PYZsh{} display subpixel corners}
        \PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{found }\PY{l+s+si}{\PYZpc{}d}\PY{l+s+s1}{ corners}\PY{l+s+s1}{\PYZsq{}}\PY{o}{\PYZpc{}}\PY{k}{C1})
        
        \PY{n}{ax} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplot}\PY{p}{(}\PY{l+m+mi}{3}\PY{p}{,}\PY{l+m+mi}{2}\PY{p}{,}\PY{l+m+mi}{6}\PY{p}{)}
        \PY{n}{plt}\PY{o}{.}\PY{n}{imshow}\PY{p}{(}\PY{n}{I2}\PY{p}{)}
        \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{C2}\PY{p}{)}\PY{p}{:}
            \PY{n}{x}\PY{p}{,}\PY{n}{y} \PY{o}{=} \PY{n}{pts2}\PY{p}{[}\PY{p}{:}\PY{p}{,}\PY{n}{i}\PY{p}{]}
            \PY{n}{ax}\PY{o}{.}\PY{n}{add\PYZus{}patch}\PY{p}{(}\PY{n}{patches}\PY{o}{.}\PY{n}{Rectangle}\PY{p}{(}\PY{p}{(}\PY{n}{x}\PY{o}{\PYZhy{}}\PY{n}{w}\PY{o}{/}\PY{l+m+mi}{2}\PY{p}{,}\PY{n}{y}\PY{o}{\PYZhy{}}\PY{n}{w}\PY{o}{/}\PY{l+m+mi}{2}\PY{p}{)}\PY{p}{,}\PY{n}{w}\PY{p}{,}\PY{n}{w}\PY{p}{,} \PY{n}{fill}\PY{o}{=}\PY{k+kc}{False}\PY{p}{)}\PY{p}{)}
        \PY{c+c1}{\PYZsh{} plt.plot(pts2[0,:], pts2[1,:], \PYZsq{}.b\PYZsq{})}
        \PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{found }\PY{l+s+si}{\PYZpc{}d}\PY{l+s+s1}{ corners}\PY{l+s+s1}{\PYZsq{}}\PY{o}{\PYZpc{}}\PY{k}{C2})
        
        \PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}


    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_7_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \paragraph{Final values for
parameters}\label{final-values-for-parameters}

\begin{itemize}
\tightlist
\item
  w = 7
\item
  t1 = 8.3*10**-4
\item
  t2 = 8.7*10**-4
\item
  w\_nms = 7
\item
  C1 = 609
\item
  C2 = 621
\end{itemize}

    \subsection{Problem 2 (Programming): Feature matching (15
points)}\label{problem-2-programming-feature-matching-15-points}

Determine the set of one-to-one putative feature correspondences by
performing a brute-force search for the greatest correlation coefficient
value (in the range {[}-1, 1{]}) between the detected features in image
1 and the detected features in image 2. Only allow matches that are
above a specified correlation coefficient threshold value (note that
calculating the correlation coefficient allows for adjusting the size of
the matching window without changing the threshold value). Further, only
allow matches that are above a specified distance ratio threshold value,
where distance is measured to the next best match for a given feature.
Vary these parameters such that around 200 putative feature
correspondences are established. Optional: constrain the search to
coordinates in image 2 that are within a proximity of the detected
feature coordinates in image 1.

\paragraph{Report your final values
for:}\label{report-your-final-values-for}

\begin{itemize}
\tightlist
\item
  the size of the matching window
\item
  the correlation coefficient threshold
\item
  the distance ratio threshold
\item
  the size of the proximity window (if used)
\item
  the resulting number of putative feature correspondences (i.e. matched
  features)
\end{itemize}

\paragraph{Display figures for:}\label{display-figures-for}

\begin{itemize}
\tightlist
\item
  pair of images, where the matched features in each of the images are
  indicated by a square window about the feature
\end{itemize}

My implementation takes around 40 seconds to run. If yours is more than
400 seconds you may lose points.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}19}]:} \PY{k}{def} \PY{n+nf}{NCC}\PY{p}{(}\PY{n}{img1}\PY{p}{,} \PY{n}{img2}\PY{p}{,} \PY{n}{pts1}\PY{p}{,} \PY{n}{pts2}\PY{p}{,} \PY{n}{w}\PY{p}{)}\PY{p}{:}
             \PY{c+c1}{\PYZsh{} compute the normalized cross correlation between image patches I1, I2}
             \PY{c+c1}{\PYZsh{} result should be in the range [\PYZhy{}1,1]}
             \PY{c+c1}{\PYZsh{}}
             \PY{c+c1}{\PYZsh{} inputs:}
             \PY{c+c1}{\PYZsh{} I1, I2 are the input images}
             \PY{c+c1}{\PYZsh{} pts1, pts2 are the point to be matched}
             \PY{c+c1}{\PYZsh{} w is the size of the matching window to compute correlation coefficients}
             \PY{c+c1}{\PYZsh{}}
             \PY{c+c1}{\PYZsh{} output:}
             \PY{c+c1}{\PYZsh{} normalized cross correlation matrix of scores between all windows in }
             \PY{c+c1}{\PYZsh{}    image 1 and all windows in image 2}
             
             \PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}your code here\PYZdq{}\PYZdq{}\PYZdq{}}
             \PY{c+c1}{\PYZsh{}\PYZsq{}\PYZsq{}\PYZsq{}}
             \PY{n}{pts1\PYZus{}n} \PY{o}{=} \PY{n}{pts1}\PY{o}{.}\PY{n}{shape}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}
             \PY{n}{pts2\PYZus{}n} \PY{o}{=} \PY{n}{pts2}\PY{o}{.}\PY{n}{shape}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}
             \PY{n}{scores} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{zeros}\PY{p}{(}\PY{p}{(}\PY{n}{pts1\PYZus{}n}\PY{p}{,}\PY{n}{pts2\PYZus{}n}\PY{p}{)}\PY{p}{)}
             \PY{n}{R} \PY{o}{=} \PY{n+nb}{int}\PY{p}{(}\PY{n}{w}\PY{o}{/}\PY{l+m+mi}{2}\PY{p}{)}
             \PY{n}{pts1\PYZus{}int} \PY{o}{=} \PY{n}{pts1}\PY{o}{.}\PY{n}{astype}\PY{p}{(}\PY{n+nb}{int}\PY{p}{)}
             \PY{n}{pts2\PYZus{}int} \PY{o}{=} \PY{n}{pts2}\PY{o}{.}\PY{n}{astype}\PY{p}{(}\PY{n+nb}{int}\PY{p}{)}
             \PY{n}{k} \PY{o}{=} \PY{l+m+mi}{0}
             \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range} \PY{p}{(}\PY{n}{pts2\PYZus{}n}\PY{p}{)}\PY{p}{:}
                 \PY{n}{x\PYZus{}2}\PY{p}{,}\PY{n}{y\PYZus{}2} \PY{o}{=} \PY{n}{pts2\PYZus{}int}\PY{p}{[}\PY{p}{:}\PY{p}{,}\PY{n}{i}\PY{p}{]}
                 \PY{k}{if} \PY{n}{R} \PY{o}{\PYZlt{}} \PY{n}{x\PYZus{}2} \PY{o}{\PYZlt{}} \PY{p}{(}\PY{n+nb}{int}\PY{p}{(}\PY{n}{img2}\PY{o}{.}\PY{n}{shape}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}\PY{o}{\PYZhy{}}\PY{n}{R}\PY{p}{)} \PY{o+ow}{and} \PY{n}{R} \PY{o}{\PYZlt{}} \PY{n}{y\PYZus{}2} \PY{o}{\PYZlt{}} \PY{p}{(}\PY{n+nb}{int}\PY{p}{(}\PY{n}{img2}\PY{o}{.}\PY{n}{shape}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{)}\PY{o}{\PYZhy{}}\PY{n}{R}\PY{p}{)}\PY{p}{:}
                     \PY{k}{for} \PY{n}{j} \PY{o+ow}{in} \PY{n+nb}{range} \PY{p}{(}\PY{n}{pts1\PYZus{}n}\PY{p}{)}\PY{p}{:}
                         \PY{n}{x\PYZus{}1}\PY{p}{,}\PY{n}{y\PYZus{}1} \PY{o}{=} \PY{n}{pts1\PYZus{}int}\PY{p}{[}\PY{p}{:}\PY{p}{,}\PY{n}{j}\PY{p}{]}
                         \PY{k}{if} \PY{n}{R} \PY{o}{\PYZlt{}} \PY{n}{x\PYZus{}1} \PY{o}{\PYZlt{}} \PY{p}{(}\PY{n+nb}{int}\PY{p}{(}\PY{n}{img1}\PY{o}{.}\PY{n}{shape}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}\PY{o}{\PYZhy{}}\PY{n}{R}\PY{p}{)} \PY{o+ow}{and} \PY{n}{R}\PY{o}{\PYZlt{}} \PY{n}{y\PYZus{}1} \PY{o}{\PYZlt{}} \PY{p}{(}\PY{n+nb}{int}\PY{p}{(}\PY{n}{img1}\PY{o}{.}\PY{n}{shape}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{)}\PY{o}{\PYZhy{}}\PY{n}{R}\PY{p}{)}\PY{p}{:}
                             \PY{n}{W1} \PY{o}{=} \PY{n}{img1}\PY{p}{[}\PY{n}{y\PYZus{}1}\PY{o}{\PYZhy{}}\PY{n}{R}\PY{p}{:}\PY{n}{y\PYZus{}1}\PY{o}{+}\PY{n}{R}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{,}\PY{n}{x\PYZus{}1}\PY{o}{\PYZhy{}}\PY{n}{R}\PY{p}{:}\PY{n}{x\PYZus{}1}\PY{o}{+}\PY{n}{R}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{]}
                             \PY{n}{W2} \PY{o}{=} \PY{n}{img2}\PY{p}{[}\PY{n}{y\PYZus{}2}\PY{o}{\PYZhy{}}\PY{n}{R}\PY{p}{:}\PY{n}{y\PYZus{}2}\PY{o}{+}\PY{n}{R}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{,}\PY{n}{x\PYZus{}2}\PY{o}{\PYZhy{}}\PY{n}{R}\PY{p}{:}\PY{n}{x\PYZus{}2}\PY{o}{+}\PY{n}{R}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{]}
                             \PY{n}{W1\PYZus{}mean} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{n}{W1}\PY{p}{)}
                             \PY{n}{W2\PYZus{}mean} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{n}{W2}\PY{p}{)}
                             \PY{n}{W1\PYZus{}num} \PY{o}{=} \PY{n}{W1} \PY{o}{\PYZhy{}} \PY{n}{W1\PYZus{}mean}
                             \PY{n}{W2\PYZus{}num} \PY{o}{=} \PY{n}{W2} \PY{o}{\PYZhy{}} \PY{n}{W2\PYZus{}mean}
                             \PY{n}{W1\PYZus{}tilde} \PY{o}{=} \PY{n}{W1\PYZus{}num}\PY{o}{/}\PY{n}{np}\PY{o}{.}\PY{n}{linalg}\PY{o}{.}\PY{n}{norm}\PY{p}{(}\PY{n}{W1\PYZus{}num}\PY{p}{)}
                             \PY{n}{W2\PYZus{}tilde} \PY{o}{=} \PY{n}{W2\PYZus{}num}\PY{o}{/}\PY{n}{np}\PY{o}{.}\PY{n}{linalg}\PY{o}{.}\PY{n}{norm}\PY{p}{(}\PY{n}{W2\PYZus{}num}\PY{p}{)}
                             \PY{n}{scores}\PY{p}{[}\PY{n}{j}\PY{p}{,}\PY{n}{i}\PY{p}{]} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{n}{W1\PYZus{}tilde}\PY{o}{*}\PY{n}{W2\PYZus{}tilde}\PY{p}{)}
                             \PY{c+c1}{\PYZsh{}print([j,i])}
         
             
             \PY{k}{return} \PY{n}{scores}
         
         
         \PY{k}{def} \PY{n+nf}{Match}\PY{p}{(}\PY{n}{scores}\PY{p}{,} \PY{n}{t}\PY{p}{,} \PY{n}{d}\PY{p}{,} \PY{n}{p}\PY{p}{)}\PY{p}{:}
             \PY{c+c1}{\PYZsh{} perform the one\PYZhy{}to\PYZhy{}one correspondence matching on the correlation coefficient matrix}
             \PY{c+c1}{\PYZsh{} }
             \PY{c+c1}{\PYZsh{} inputs:}
             \PY{c+c1}{\PYZsh{} scores is the NCC matrix}
             \PY{c+c1}{\PYZsh{} t is the correlation coefficient threshold}
             \PY{c+c1}{\PYZsh{} d distance ration threshold}
             \PY{c+c1}{\PYZsh{} p is the size of the proximity window}
             \PY{c+c1}{\PYZsh{}}
             \PY{c+c1}{\PYZsh{} output:}
             \PY{c+c1}{\PYZsh{} list of the feature coordinates in image 1 and image 2 }
             
             \PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}your code here\PYZdq{}\PYZdq{}\PYZdq{}}
             \PY{c+c1}{\PYZsh{}inds = np.vstack((np.random.choice(pts1.shape[1],200,replace=False), }
               \PY{c+c1}{\PYZsh{}                np.random.choice(pts1.shape[1],200,replace=False)))}
             \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range} \PY{p}{(}\PY{n}{scores}\PY{o}{.}\PY{n}{shape}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{)}\PY{p}{:}
                 \PY{k}{for} \PY{n}{j} \PY{o+ow}{in} \PY{n+nb}{range} \PY{p}{(}\PY{n}{scores}\PY{o}{.}\PY{n}{shape}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}\PY{p}{:}
                     \PY{k}{if} \PY{n}{scores}\PY{p}{[}\PY{n}{i}\PY{p}{,}\PY{n}{j}\PY{p}{]} \PY{o}{\PYZlt{}} \PY{n}{t}\PY{p}{:}
                         \PY{n}{scores}\PY{p}{[}\PY{n}{i}\PY{p}{,}\PY{n}{j}\PY{p}{]} \PY{o}{=} \PY{o}{\PYZhy{}}\PY{l+m+mi}{1}
             
             \PY{n}{mask} \PY{o}{=} \PY{p}{(}\PY{n}{scores} \PY{o}{\PYZlt{}} \PY{l+m+mi}{100}\PY{p}{)}
             \PY{n}{inds} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{zeros}\PY{p}{(}\PY{p}{(}\PY{l+m+mi}{2}\PY{p}{,}\PY{l+m+mi}{200}\PY{p}{)}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}scores\PYZus{}copy = scores.copy()}
             \PY{n}{WTH} \PY{o}{=} \PY{n}{scores}\PY{o}{.}\PY{n}{shape}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}
             \PY{n}{LTH} \PY{o}{=} \PY{n}{scores}\PY{o}{.}\PY{n}{shape}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}
             \PY{n}{j} \PY{o}{=} \PY{l+m+mi}{0} 
             \PY{n}{i} \PY{o}{=} \PY{l+m+mi}{0}
             \PY{k}{while} \PY{k+kc}{True}\PY{p}{:}
                 \PY{k}{if} \PY{n}{scores}\PY{p}{[}\PY{n}{mask}\PY{p}{]}\PY{o}{.}\PY{n}{shape} \PY{o}{==} \PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,}\PY{p}{)} \PY{p}{:}
                     \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Not enough matching points}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
                     \PY{k}{break}
                 \PY{n}{scores\PYZus{}copy} \PY{o}{=} \PY{n}{scores}\PY{p}{[}\PY{n}{mask}\PY{p}{]}\PY{o}{.}\PY{n}{reshape}\PY{p}{(}\PY{p}{(}\PY{n}{LTH}\PY{o}{\PYZhy{}}\PY{n}{j}\PY{p}{,}\PY{n}{WTH}\PY{o}{\PYZhy{}}\PY{n}{j}\PY{p}{)}\PY{p}{)}
                 
                 \PY{n}{first\PYZus{}maximum} \PY{o}{=} \PY{n}{scores\PYZus{}copy}\PY{o}{.}\PY{n}{max}\PY{p}{(}\PY{p}{)}
                 \PY{n}{max\PYZus{}pos\PYZus{}copy} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{where}\PY{p}{(}\PY{n}{scores\PYZus{}copy} \PY{o}{==} \PY{n}{first\PYZus{}maximum}\PY{p}{)}
                 \PY{n}{scores\PYZus{}copy}\PY{p}{[}\PY{n}{max\PYZus{}pos\PYZus{}copy}\PY{p}{]} \PY{o}{=} \PY{o}{\PYZhy{}}\PY{l+m+mi}{1}
                 \PY{n}{next\PYZus{}maximum} \PY{o}{=} \PY{n+nb}{max}\PY{p}{(}\PY{n}{scores\PYZus{}copy}\PY{p}{[}\PY{n}{max\PYZus{}pos\PYZus{}copy}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{,}\PY{p}{:}\PY{p}{]}\PY{o}{.}\PY{n}{max}\PY{p}{(}\PY{p}{)}\PY{p}{,}\PY{n}{scores\PYZus{}copy}\PY{p}{[}\PY{p}{:}\PY{p}{,}\PY{n}{max\PYZus{}pos\PYZus{}copy}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{]}\PY{o}{.}\PY{n}{max}\PY{p}{(}\PY{p}{)}\PY{p}{)}
                 \PY{n}{max\PYZus{}pos} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{where}\PY{p}{(}\PY{n}{scores} \PY{o}{==} \PY{n}{first\PYZus{}maximum}\PY{p}{)}
                 \PY{k}{if} \PY{p}{(}\PY{l+m+mi}{1}\PY{o}{\PYZhy{}}\PY{n}{first\PYZus{}maximum}\PY{p}{)} \PY{o}{\PYZlt{}} \PY{p}{(}\PY{l+m+mi}{1}\PY{o}{\PYZhy{}} \PY{n}{next\PYZus{}maximum}\PY{p}{)}\PY{o}{*}\PY{n}{d}\PY{p}{:}
                     \PY{n}{inds}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{,}\PY{n}{i}\PY{p}{]} \PY{o}{=} \PY{n}{max\PYZus{}pos}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}
                     \PY{n}{inds}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,}\PY{n}{i}\PY{p}{]} \PY{o}{=} \PY{n}{max\PYZus{}pos}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}
                     \PY{n}{i} \PY{o}{+}\PY{o}{=} \PY{l+m+mi}{1}
                     \PY{k}{if} \PY{n}{i} \PY{o}{==} \PY{l+m+mi}{200}\PY{p}{:}
                         \PY{k}{break}
                 \PY{n}{mask}\PY{p}{[}\PY{n}{max\PYZus{}pos}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{,}\PY{p}{:}\PY{p}{]} \PY{o}{=} \PY{k+kc}{False}
                 \PY{n}{mask}\PY{p}{[}\PY{p}{:}\PY{p}{,}\PY{n}{max\PYZus{}pos}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{]} \PY{o}{=} \PY{k+kc}{False}
                 \PY{n}{j} \PY{o}{+}\PY{o}{=} \PY{l+m+mi}{1}
                 
         
                     \PY{c+c1}{\PYZsh{}print(j)}
             \PY{n}{inds} \PY{o}{=} \PY{n}{inds}\PY{o}{.}\PY{n}{astype}\PY{p}{(}\PY{n+nb}{int}\PY{p}{)}
             \PY{k}{return} \PY{n}{inds}
         
         
         
         \PY{k}{def} \PY{n+nf}{RunFeatureMatching}\PY{p}{(}\PY{n}{I1}\PY{p}{,} \PY{n}{I2}\PY{p}{,} \PY{n}{pts1}\PY{p}{,} \PY{n}{pts2}\PY{p}{,} \PY{n}{w}\PY{p}{,} \PY{n}{t}\PY{p}{,} \PY{n}{d}\PY{p}{,} \PY{n}{p}\PY{p}{)}\PY{p}{:}
             \PY{c+c1}{\PYZsh{} inputs:}
             \PY{c+c1}{\PYZsh{} I1, I2 are the input images}
             \PY{c+c1}{\PYZsh{} pts1, pts2 are the point to be matched}
             \PY{c+c1}{\PYZsh{} w is the size of the matching window to compute correlation coefficients}
             \PY{c+c1}{\PYZsh{} t is the correlation coefficient threshold}
             \PY{c+c1}{\PYZsh{} d distance ration threshold}
             \PY{c+c1}{\PYZsh{} p is the size of the proximity window}
             \PY{c+c1}{\PYZsh{}}
             \PY{c+c1}{\PYZsh{} outputs:}
             \PY{c+c1}{\PYZsh{} inds is a 2xk matrix of matches where inds[0,i] indexs a point pts1 }
             \PY{c+c1}{\PYZsh{}     and inds[1,i] indexs a point in pts2, where k is the number of matches}
             
             \PY{n}{scores} \PY{o}{=} \PY{n}{NCC}\PY{p}{(}\PY{n}{I1}\PY{p}{,} \PY{n}{I2}\PY{p}{,} \PY{n}{pts1}\PY{p}{,} \PY{n}{pts2}\PY{p}{,} \PY{n}{w}\PY{p}{)}
             \PY{n}{inds} \PY{o}{=} \PY{n}{Match}\PY{p}{(}\PY{n}{scores}\PY{p}{,}\PY{n}{t}\PY{p}{,}\PY{n}{d}\PY{p}{,}\PY{n}{p}\PY{p}{)} 
             \PY{k}{return} \PY{n}{inds}\PY{p}{,}\PY{n}{scores}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}72}]:} \PY{c+c1}{\PYZsh{} parameters to tune}
         \PY{c+c1}{\PYZsh{} 0.8 12 features}
         \PY{c+c1}{\PYZsh{}0.9 12 features}
         \PY{c+c1}{\PYZsh{}0.7 12 features}
         \PY{c+c1}{\PYZsh{} 7/0.85/1 200 features good for now }
         \PY{c+c1}{\PYZsh{} 7/0.88/1 200 not enough pts/ but better  }
         \PY{c+c1}{\PYZsh{} 5/0.88/1 200  worse  }
         \PY{c+c1}{\PYZsh{} 7/0.85/0.8 200  not enough pts/ but better }
         \PY{c+c1}{\PYZsh{} 7/0.87/1 200  not enough pts/ but better }
         \PY{c+c1}{\PYZsh{} 9/0.85/1 200  best}
         \PY{c+c1}{\PYZsh{}\PYZhy{}/\PYZhy{}/0.95 not enough}
         \PY{n}{w} \PY{o}{=} \PY{l+m+mi}{9}
         \PY{n}{t} \PY{o}{=} \PY{l+m+mf}{0.85}
         \PY{n}{d} \PY{o}{=} \PY{l+m+mi}{1}
         \PY{n}{p} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{inf}
         
         \PY{n}{tic} \PY{o}{=} \PY{n}{time}\PY{o}{.}\PY{n}{time}\PY{p}{(}\PY{p}{)}
         \PY{c+c1}{\PYZsh{} run the feature matching algorithm on the input images and detected features}
         \PY{n}{inds}\PY{p}{,}\PY{n}{scores} \PY{o}{=} \PY{n}{RunFeatureMatching}\PY{p}{(}\PY{n}{I1\PYZus{}gray}\PY{p}{,} \PY{n}{I2\PYZus{}gray}\PY{p}{,} \PY{n}{pts1}\PY{p}{,} \PY{n}{pts2}\PY{p}{,} \PY{n}{w}\PY{p}{,} \PY{n}{t}\PY{p}{,} \PY{n}{d}\PY{p}{,} \PY{n}{p}\PY{p}{)}
         \PY{n}{toc} \PY{o}{=} \PY{n}{time}\PY{o}{.}\PY{n}{time}\PY{p}{(}\PY{p}{)} \PY{o}{\PYZhy{}} \PY{n}{tic}
         
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{took }\PY{l+s+si}{\PYZpc{}f}\PY{l+s+s1}{ secs}\PY{l+s+s1}{\PYZsq{}}\PY{o}{\PYZpc{}}\PY{k}{toc})
         
         \PY{c+c1}{\PYZsh{} create new matrices of points which contain only the matched features }
         \PY{n}{match1} \PY{o}{=} \PY{n}{pts1}\PY{p}{[}\PY{p}{:}\PY{p}{,}\PY{n}{inds}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{,}\PY{p}{:}\PY{p}{]}\PY{p}{]}
         \PY{n}{match2} \PY{o}{=} \PY{n}{pts2}\PY{p}{[}\PY{p}{:}\PY{p}{,}\PY{n}{inds}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,}\PY{p}{:}\PY{p}{]}\PY{p}{]}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
took 24.779633 secs

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}75}]:} \PY{c+c1}{\PYZsh{} display the results}
         \PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{14}\PY{p}{,}\PY{l+m+mi}{24}\PY{p}{)}\PY{p}{)}
         \PY{n}{ax1} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplot}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mi}{2}\PY{p}{,}\PY{l+m+mi}{1}\PY{p}{)}
         \PY{n}{ax2} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplot}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mi}{2}\PY{p}{,}\PY{l+m+mi}{2}\PY{p}{)}
         \PY{n}{ax1}\PY{o}{.}\PY{n}{imshow}\PY{p}{(}\PY{n}{I1}\PY{p}{)}
         \PY{n}{ax2}\PY{o}{.}\PY{n}{imshow}\PY{p}{(}\PY{n}{I2}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{found }\PY{l+s+si}{\PYZpc{}d}\PY{l+s+s1}{ putative matches}\PY{l+s+s1}{\PYZsq{}}\PY{o}{\PYZpc{}}\PY{k}{match1}.shape[1])
         \PY{n}{w1} \PY{o}{=} \PY{l+m+mi}{7}
         \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{match1}\PY{o}{.}\PY{n}{shape}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}\PY{p}{:}
             \PY{n}{x1}\PY{p}{,}\PY{n}{y1} \PY{o}{=} \PY{n}{match1}\PY{p}{[}\PY{p}{:}\PY{p}{,}\PY{n}{i}\PY{p}{]}
             \PY{n}{x2}\PY{p}{,}\PY{n}{y2} \PY{o}{=} \PY{n}{match2}\PY{p}{[}\PY{p}{:}\PY{p}{,}\PY{n}{i}\PY{p}{]}
             \PY{n}{ax1}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{p}{[}\PY{n}{x1}\PY{p}{,} \PY{n}{x2}\PY{p}{]}\PY{p}{,}\PY{p}{[}\PY{n}{y1}\PY{p}{,} \PY{n}{y2}\PY{p}{]}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}r}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
             \PY{n}{ax1}\PY{o}{.}\PY{n}{add\PYZus{}patch}\PY{p}{(}\PY{n}{patches}\PY{o}{.}\PY{n}{Rectangle}\PY{p}{(}\PY{p}{(}\PY{n}{x1}\PY{o}{\PYZhy{}}\PY{n}{w1}\PY{o}{/}\PY{l+m+mi}{2}\PY{p}{,}\PY{n}{y1}\PY{o}{\PYZhy{}}\PY{n}{w1}\PY{o}{/}\PY{l+m+mi}{2}\PY{p}{)}\PY{p}{,}\PY{n}{w1}\PY{p}{,}\PY{n}{w1}\PY{p}{,} \PY{n}{fill}\PY{o}{=}\PY{k+kc}{False}\PY{p}{)}\PY{p}{)}
             \PY{n}{ax2}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{p}{[}\PY{n}{x2}\PY{p}{,} \PY{n}{x1}\PY{p}{]}\PY{p}{,}\PY{p}{[}\PY{n}{y2}\PY{p}{,} \PY{n}{y1}\PY{p}{]}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}r}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
             \PY{n}{ax2}\PY{o}{.}\PY{n}{add\PYZus{}patch}\PY{p}{(}\PY{n}{patches}\PY{o}{.}\PY{n}{Rectangle}\PY{p}{(}\PY{p}{(}\PY{n}{x2}\PY{o}{\PYZhy{}}\PY{n}{w1}\PY{o}{/}\PY{l+m+mi}{2}\PY{p}{,}\PY{n}{y2}\PY{o}{\PYZhy{}}\PY{n}{w1}\PY{o}{/}\PY{l+m+mi}{2}\PY{p}{)}\PY{p}{,}\PY{n}{w1}\PY{p}{,}\PY{n}{w1}\PY{p}{,} \PY{n}{fill}\PY{o}{=}\PY{k+kc}{False}\PY{p}{)}\PY{p}{)}
         
         \PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
         
         \PY{c+c1}{\PYZsh{} test 1\PYZhy{}1}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{unique points in image 1: }\PY{l+s+si}{\PYZpc{}d}\PY{l+s+s1}{\PYZsq{}}\PY{o}{\PYZpc{}}\PY{k}{np}.unique(inds[0,:]).shape[0])
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{unique points in image 2: }\PY{l+s+si}{\PYZpc{}d}\PY{l+s+s1}{\PYZsq{}}\PY{o}{\PYZpc{}}\PY{k}{np}.unique(inds[1,:]).shape[0])
\end{Verbatim}


    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_12_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
unique points in image 1: 200
unique points in image 2: 200

    \end{Verbatim}

    \paragraph{Final values for
parameters}\label{final-values-for-parameters}

\begin{itemize}
\tightlist
\item
  w = 9
\item
  t = 0.85
\item
  d = 1
\item
  p = np.inf
\item
  num\_matches = 200
\end{itemize}


    % Add a bibliography block to the postdoc
    
    
    
    \end{document}
